"use strict";const e=require("../../common/vendor.js"),a=require("../../api/index.js");if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-forms")+e.resolveComponent("uni-data-checkbox"))()}Math||((()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-easyinput/uni-easyinput.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-forms-item/uni-forms-item.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-forms/uni-forms.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-data-checkbox/uni-data-checkbox.js"))();const l={__name:"register",setup(l){const o=e.ref(1),r=e.ref(null),s=e.ref(null),d=e.ref(null),i=e.ref({name:"",email:"",password:"",confirmPassword:"",phone_number:"",address:"",avatar_url:"",gender:"OTHER",company_id:"",description:"",code:""}),n=e.ref(0);let u=null;const t=e.ref([{text:"男",value:"MALE"},{text:"女",value:"FEMALE"},{text:"其他",value:"OTHER"}]),c={email:{rules:[{required:!0,errorMessage:"邮箱不能为空"},{format:"email",errorMessage:"邮箱格式不正确"}]},code:{rules:[{required:!0,errorMessage:"验证码不能为空"}]},name:{rules:[{required:!0,errorMessage:"用户姓名不能为空"}]},password:{rules:[{required:!0,errorMessage:"密码不能为空"}]},confirmPassword:{rules:[{required:!0,errorMessage:"请确认密码"},{validateFunction:(e,a,l,o)=>(a!==l.password&&o("两次输入的密码不一致"),!0)}]},company_id:{rules:[{required:!0,errorMessage:"公司ID不能为空"}]}},m=()=>{r.value.validate().then((async()=>{e.index.showLoading({title:"正在发送..."});const l=await a.generateVerifyCode({email:i.value.email});e.index.hideLoading(),200===l.code?(e.index.showToast({title:"验证码已发送",icon:"success"}),o.value=2,n.value=60,u&&clearInterval(u),u=setInterval((()=>{n.value>0?n.value--:clearInterval(u)}),1e3)):e.index.showToast({title:l.message||"发送失败",icon:"none"})}))},p=()=>{s.value.validate().then((async()=>{e.index.showLoading({title:"正在验证..."});const l=await a.verifyCode({email:i.value.email,code:i.value.code});e.index.hideLoading(),200===l.code?(e.index.showToast({title:"验证成功",icon:"success"}),o.value=3,clearInterval(u)):e.index.showToast({title:l.message||"验证失败",icon:"none"})}))},v=()=>{d.value.validate().then((async()=>{e.index.showLoading({title:"正在注册..."});const{confirmPassword:l,code:o,...r}=i.value;try{const l=await a.registerIndividual(r);e.index.hideLoading(),200===l.code?(e.index.showToast({title:"注册成功！",icon:"success"}),setTimeout((()=>{e.index.redirectTo({url:"/pages/auth/login"})}),1500)):e.index.showToast({title:l.message||"注册失败",icon:"none"})}catch(s){e.index.hideLoading(),e.index.showToast({title:"网络请求失败",icon:"none"})}}))},h=()=>{e.index.redirectTo({url:"/pages/auth/login"})};return(a,l)=>e.e({a:1===o.value},1===o.value?{b:e.o((e=>i.value.email=e)),c:e.p({placeholder:"请输入您的邮箱地址",modelValue:i.value.email}),d:e.p({label:"邮箱",name:"email"}),e:e.sr(r,"1c4fc1da-0",{k:"step1Form"}),f:e.p({modelValue:i.value,rules:c}),g:e.o(m)}:{},{h:2===o.value},2===o.value?e.e({i:e.t(i.value.email),j:e.o((e=>i.value.code=e)),k:e.p({placeholder:"请输入6位验证码",modelValue:i.value.code}),l:e.p({label:"验证码",name:"code"}),m:e.sr(s,"1c4fc1da-3",{k:"step2Form"}),n:e.p({modelValue:i.value,rules:c}),o:e.o(p),p:n.value>0},n.value>0?{q:e.t(n.value)}:{r:e.o(m)}):{},{s:3===o.value},3===o.value?{t:e.o((e=>i.value.name=e)),v:e.p({placeholder:"请输入您的姓名",modelValue:i.value.name}),w:e.p({label:"用户姓名",name:"name",required:!0}),x:e.o((e=>i.value.password=e)),y:e.p({type:"password",placeholder:"请输入密码",modelValue:i.value.password}),z:e.p({label:"密码",name:"password",required:!0}),A:e.o((e=>i.value.confirmPassword=e)),B:e.p({type:"password",placeholder:"请再次输入密码",modelValue:i.value.confirmPassword}),C:e.p({label:"确认密码",name:"confirmPassword",required:!0}),D:e.o((e=>i.value.company_id=e)),E:e.p({placeholder:"请输入您的公司ID",modelValue:i.value.company_id}),F:e.p({label:"公司ID",name:"company_id",required:!0}),G:e.o((e=>i.value.gender=e)),H:e.p({localdata:t.value,modelValue:i.value.gender}),I:e.p({label:"性别",name:"gender"}),J:e.o((e=>i.value.phone_number=e)),K:e.p({placeholder:"请输入电话号码 (选填)",modelValue:i.value.phone_number}),L:e.p({label:"电话号码",name:"phone_number"}),M:e.o((e=>i.value.address=e)),N:e.p({placeholder:"请输入您的地址 (选填)",modelValue:i.value.address}),O:e.p({label:"地址",name:"address"}),P:e.o((e=>i.value.description=e)),Q:e.p({type:"textarea",placeholder:"简单介绍一下自己吧 (选填)",modelValue:i.value.description}),R:e.p({label:"个人简介",name:"description"}),S:e.sr(d,"1c4fc1da-6",{k:"step3Form"}),T:e.p({modelValue:i.value,rules:c,"label-width":"80px"}),U:e.o(v)}:{},{V:3!==o.value},3!==o.value?{W:e.o(h)}:{})}},o=e._export_sfc(l,[["__scopeId","data-v-1c4fc1da"]]);wx.createPage(o);

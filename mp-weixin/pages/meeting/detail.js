"use strict";const e=require("../../common/vendor.js"),o=require("../../api/index.js");if(!Array){(e.resolveComponent("uni-load-more")+e.resolveComponent("uni-icons")+e.resolveComponent("uni-popup-dialog")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-load-more/uni-load-more.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-popup-dialog/uni-popup-dialog.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-popup/uni-popup.js"))();const i={__name:"detail",setup(i){const n=e.ref(null),t=e.ref(!0),a=e.ref(""),l=e.ref(null);let s="",u="";const d=e.ref("all"),c=()=>{e.index.showModal({title:"确认取消",content:"您确定要取消本次会议的报名吗？",success:async i=>{if(i.confirm){if(!u)return void e.index.showToast({title:"参会记录ID丢失，无法取消",icon:"none"});e.index.showLoading({title:"正在取消..."});try{const i=await o.cancelMeetingParticipation(u);e.index.hideLoading(),i&&200===i.code?(e.index.showToast({title:"取消成功",icon:"success"}),e.index.$emit("meetingListNeedRefresh"),setTimeout((()=>{e.index.navigateBack()}),1500)):e.index.showToast({title:i&&i.message||"取消失败",icon:"none"})}catch(n){e.index.hideLoading(),e.index.showToast({title:"网络错误",icon:"none"})}}}})},r=e=>e?e.replace("T"," ").substring(0,16):"时间待定",p=()=>{l.value&&l.value.open()},v=async i=>{if(!s)return void e.index.showToast({title:"会议ID丢失，无法报名",icon:"none"});const n=i||"该用户没有填写报名理由。";e.index.showLoading({title:"正在提交申请..."});try{const i={meeting_uuid:s,join_reason:n},t=await o.joinMeeting(i);e.index.hideLoading(),t&&200===t.code?e.index.showToast({title:"报名申请已提交！",icon:"success"}):e.index.showToast({title:t&&t.message||"报名失败",icon:"none"})}catch(t){e.index.hideLoading(),console.error("报名请求失败:",t),e.index.showToast({title:"网络或服务器错误",icon:"none"})}};return e.onLoad((async e=>{if(!e||!e.uuid)return t.value=!1,void(a.value="页面缺少会议ID参数。");s=e.uuid,e.from&&(d.value=e.from),e.part_uuid&&(u=e.part_uuid);try{const e=await o.getMeetingDetail(s);if(!e||200!==e.code||!e.data)throw new Error(e&&e.message||"获取会议详情失败");n.value=e.data}catch(i){a.value=i.message}finally{t.value=!1}})),(o,i)=>e.e({a:t.value},t.value?{b:e.p({status:"loading"})}:a.value?{d:e.t(a.value)}:n.value?e.e({f:n.value.coverImageUrl||"https://images.pexels.com/photos/2422290/pexels-photo-2422290.jpeg",g:e.t(n.value.name),h:e.p({type:"flag",size:"16",color:"#999"}),i:e.t(n.value.status),j:e.p({type:"calendar",size:"16",color:"#999"}),k:e.t(r(n.value.startTime)),l:e.p({type:"calendar",size:"16",color:"#999"}),m:e.t(r(n.value.endTime)),n:e.p({type:"chat",size:"16",color:"#999"}),o:e.t(n.value.description||"暂无描述"),p:"all"===d.value},"all"===d.value?{q:e.o(p)}:{},{r:"my"===d.value},"my"===d.value?{s:e.o(c)}:{}):{},{c:a.value,e:n.value,t:e.o(v),v:e.p({mode:"input",title:"填写报名理由",placeholder:"请输入您的报名理由（选填）"}),w:e.sr(l,"50f31ba5-5",{k:"inputDialog"}),x:e.p({type:"dialog"})})}},n=e._export_sfc(i,[["__scopeId","data-v-50f31ba5"]]);wx.createPage(n);

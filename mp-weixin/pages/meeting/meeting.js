"use strict";const e=require("../../common/vendor.js"),a=require("../../api/index.js");if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-icons")+e.resolveComponent("uni-load-more"))()}Math||((()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-easyinput/uni-easyinput.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-load-more/uni-load-more.js"))();const l={__name:"meeting",setup(l){const o=e.ref(""),t=e.ref("all"),u=e.ref([]),s=e.ref(""),i=e.ref(!1),n=e.ref(1),r=e.ref("more"),d=e.reactive({list:[],page:1,size:10,loadStatus:"more",errorMsg:"",isLoading:!1}),v=async(e=!1)=>{if(e&&(n.value=1,u.value=[],r.value="more",s.value=""),"noMore"!==r.value&&!i.value){i.value=!0,1===n.value&&(r.value="loading");try{let l;const t=o.value.trim(),d={page:n.value,size:10};if(t?(d.name=t,console.log("执行会议搜索, 参数:",d),l=await a.searchMeetingsByName(d)):(console.log("执行获取全部会议列表, 参数:",d),l=await a.getAllMeetings(d)),l&&200===l.code&&Array.isArray(l.data)){const a=l.data;u.value=e?a:[...u.value,...a],a.length<10?r.value="noMore":r.value="more",n.value++}else r.value="noMore",e&&(u.value=[]),s.value=l&&l.message||"加载会议列表失败"}catch(l){r.value="more",s.value="网络错误，请稍后重试"}finally{i.value=!1}}},g=async(e=!1)=>{if(e&&Object.assign(d,{list:[],page:1,loadStatus:"more",errorMsg:""}),"noMore"!==d.loadStatus&&"loading"!==d.loadStatus){d.loadStatus="loading";try{const e=await a.getMyMeetingParts({page:d.page,size:d.size});if(e&&200===e.code&&Array.isArray(e.data)){const a=e.data;d.list.push(...a),d.loadStatus=a.length<d.size?"noMore":"more",d.page++}else d.loadStatus="noMore",d.errorMsg=e&&e.message||"加载失败"}catch(l){d.loadStatus="more",d.errorMsg="网络错误"}}},c=()=>{v(!0)},m=()=>{""===o.value&&v(!0)},p=e=>{t.value!==e&&(t.value=e,"all"===e&&0===u.value.length?v(!0):"my"===e&&0===d.list.length&&g(!0))},f=(a,l="all",o="")=>{a?e.index.navigateTo({url:`/pages/meeting/detail?uuid=${a}&from=${l}&part_uuid=${o}`}):e.index.showToast({title:"会议ID无效",icon:"none"})},h=e=>`status-${e}`,y=e=>e?e.replace("T"," ").substring(0,16):"时间待定";return e.onShow((()=>{v(!0)})),e.onPullDownRefresh((()=>{("all"===t.value?v(!0):g(!0)).finally((()=>e.index.stopPullDownRefresh()))})),e.onReachBottom((()=>{"all"===t.value?v():g()})),e.onMounted((()=>{e.index.$on("meetingListNeedRefresh",(()=>{console.log("接收到刷新事件，正在刷新“我的会议”列表..."),"my"===t.value&&g(!0)}))})),(a,l)=>e.e({a:e.o(c),b:e.o(m),c:e.o((e=>o.value=e)),d:e.p({prefixIcon:"search",placeholder:"搜索会议名称",modelValue:o.value}),e:e.n({active:"all"===t.value}),f:e.o((e=>p("all"))),g:e.n({active:"my"===t.value}),h:e.o((e=>p("my"))),i:"all"===t.value},"all"===t.value?e.e({j:s.value},s.value?{k:e.t(s.value)}:u.value.length>0?{m:e.f(u.value,((a,l,o)=>({a:a.cover_image_url||"https://images.pexels.com/photos/2422290/pexels-photo-2422290.jpeg",b:e.t(a.name),c:"ebf5ed63-1-"+o,d:e.t(y(a.start_time)),e:"ebf5ed63-2-"+o,f:e.t(a.status),g:a.meeting_uuid,h:e.o((e=>f(a.meeting_uuid)),a.meeting_uuid)}))),n:e.p({type:"calendar",size:"14",color:"#999"}),o:e.p({type:"flag",size:"14",color:"#999"})}:(i.value,{}),{l:u.value.length>0,p:!i.value}):{},{q:"my"===t.value},"my"===t.value?e.e({r:d.errorMsg},d.errorMsg?{s:e.t(d.errorMsg)}:d.list.length>0?{v:e.f(d.list,((a,l,o)=>{return{a:e.t(a.meeting_uuid),b:e.t((t=a.status,{pending:"审核中",approved:"已通过",rejected:"已拒绝",cancelled:"已取消"}[t]||"未知")),c:e.n(h(a.status)),d:"ebf5ed63-3-"+o,e:e.t(a.join_reason||"无"),f:"ebf5ed63-4-"+o,g:e.t(y(a.created_at)),h:a.uuid,i:e.o((e=>f(a.meeting_uuid,"my",a.uuid)),a.uuid)};var t})),w:e.p({type:"help",size:"16",color:"#999"}),x:e.p({type:"calendar",size:"16",color:"#999"})}:(d.loadStatus,{}),{t:d.list.length>0,y:"loading"!==d.loadStatus,z:e.p({status:d.loadStatus})}):{},{A:"all"===t.value},"all"===t.value?{B:e.p({status:r.value})}:{})}},o=e._export_sfc(l,[["__scopeId","data-v-ebf5ed63"]]);wx.createPage(o);

"use strict";const e=require("../../common/vendor.js"),o=require("../../api/index.js");if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-load-more"))()}Math||((()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-easyinput/uni-easyinput.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-load-more/uni-load-more.js"))();const a={__name:"course",setup(a){const n=e.ref(""),l=e.ref([]),t=e.ref(1),u=e.ref("more");let r=0;const s=e.reactive({contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"没有更多数据了"}),i=async(a=!1)=>{if(a&&(t.value=0,l.value=[],r=1e3,u.value="more"),"noMore"!==u.value&&"loading"!==u.value){u.value="loading";try{let s,i;n.value&&""!==n.value.trim()?(console.log(`执行搜索, 关键词: "${n.value}"`),s=o.searchCourses,i={key_word:n.value}):(console.log("执行获取全部课程列表"),s=o.getAllCourses,i={page:t.value,pageSize:1e4});const d=await s(i);if(console.log("1. 完整的后端响应 (res):",JSON.parse(JSON.stringify(d||{}))),d&&200===d.code&&d.data&&Array.isArray(d.data.list)){const{list:e,total:o}=d.data;r=o,l.value=a?e:[...l.value,...e],l.value.length>=r||0===e.length?u.value="noMore":u.value="more",t.value++}else u.value="noMore",a&&(l.value=[]),d&&d.message&&e.index.showToast({title:d.message,icon:"none"})}catch(s){u.value="more",console.error("获取课程时捕获到错误:",s),e.index.showToast({title:"加载失败，请稍后重试",icon:"none"})}}},d=()=>{i(!0)};return e.onShow((()=>{i(!0)})),e.onPullDownRefresh((()=>{i(!0).then((()=>e.index.stopPullDownRefresh()))})),e.onReachBottom((()=>{i()})),(o,a)=>e.e({a:e.o(d),b:e.o((e=>n.value=e)),c:e.p({prefixIcon:"search",placeholder:"搜索课程名称",modelValue:n.value}),d:l.value.length>0},l.value.length>0?{e:e.f(l.value,((o,a,n)=>({a:o.image_url,b:e.t(o.name),c:e.t(o.author_name),d:e.t(o.description),e:o.uuid,f:e.o((a=>{return n=o.uuid,console.log(`准备跳转到详情页，UUID是: ${n}`),void(n?e.index.navigateTo({url:`/pages/course/detail?uuid=${n}`}):e.index.showToast({title:"课程ID无效，无法跳转！",icon:"none"}));var n}),o.uuid)})))}:{},{f:0===l.value.length&&"loading"!==u.value},(0===l.value.length&&u.value,{}),{g:e.p({status:u.value,"content-text":s})})}},n=e._export_sfc(a,[["__scopeId","data-v-609b9ada"]]);wx.createPage(n);

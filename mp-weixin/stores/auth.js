"use strict";const e=require("../common/vendor.js"),o=require("../api/index.js"),n=e.defineStore("auth",{state:()=>({accessToken:e.index.getStorageSync("access_token")||null,refreshToken:e.index.getStorageSync("refresh_token")||null}),getters:{isAuthenticated:e=>!!e.accessToken},actions:{async login(n){console.info("ğŸ” å¼€å§‹ç™»å½•æµç¨‹...");try{const s=await o.userLogin(n);if(!s||200!==s.code||!s.data){const o=s&&s.message||"ç™»å½•å¤±è´¥ï¼ŒæœªçŸ¥é”™è¯¯";return e.index.showToast({title:o,icon:"none"}),Promise.reject(new Error(o))}{console.log("âœ… ç™»å½•æˆåŠŸï¼Œè·å–Token");const{access_token:o,refresh_token:n}=s.data;if(!o||!n)throw new Error("åç«¯è¿”å›çš„Tokenä¸ºç©º");this.accessToken=o,this.refreshToken=n,e.index.setStorageSync("access_token",o),e.index.setStorageSync("refresh_token",n),console.log("ğŸ”‘ Tokenå·²æˆåŠŸä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨"),e.index.showToast({title:"ç™»å½•æˆåŠŸ",icon:"success"}),setTimeout((()=>{e.index.switchTab({url:"/pages/index/index"})}),1500)}}catch(s){throw console.error("âŒ ç™»å½•è¯·æ±‚å¼‚å¸¸:",s),e.index.showToast({title:"ç™»å½•æœåŠ¡å¼‚å¸¸ï¼Œè¯·ç¨åå†è¯•",icon:"none"}),s}},logout(o=!0){console.info("ğŸšª å¼€å§‹ç™»å‡ºæµç¨‹"),this.accessToken=null,this.refreshToken=null,e.index.removeStorageSync("access_token"),e.index.removeStorageSync("refresh_token"),o&&e.index.showToast({title:"å·²é€€å‡ºç™»å½•",icon:"none"}),e.index.reLaunch({url:"/pages/auth/login"})}}});exports.useAuthStore=n;
